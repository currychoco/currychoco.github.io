---
layout: post
title: CI/CD íŒŒì¼ ì„¤ì •
categories: [ì¼ìƒ ì¤‘ ê¶ê¸ˆí–ˆë˜]
comments: true
---


# GitLab CI/CD ìë™ ë°°í¬ ì„¤ì •

## 1. `gitlab-ci.yml` íŒŒì¼ ì˜ˆì‹œ
```yaml
stages:
  - DEPLOY

TEST-RUN:
  stage: DEPLOY
  when: manual
  tags:
    - test-runner
  script:
    - echo "Deploying to TEST environment"
    - export ssh_user="test_user"
    - export ssh_host="192.168.1.100"
    - export ssh_opt="-o StrictHostKeyChecking=no"
    - export base_path="/home/test_user/app/"
    - export dir_name="deploy"
    - chmod 400 ${TEST_PEM}
    - scp ${ssh_opt} -r -O * ${ssh_user}@${ssh_host}:${base_path}/${dir_name}/
```

---

## 2. ì£¼ìš” ê°œë… ì„¤ëª…

### ğŸ”¹ `stage`
- íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ë‹¨ê³„ë¥¼ ì •ì˜í•¨.
- ìœ„ ì˜ˆì œì—ì„œëŠ” **`DEPLOY` ë‹¨ê³„ì—ì„œ ì‹¤í–‰ë¨**.

### ğŸ”¹ `when`
- ì‹¤í–‰ ì¡°ê±´ì„ ì„¤ì •í•¨.
- `manual`ì´ë¯€ë¡œ **ì§ì ‘ ì‹¤í–‰í•´ì•¼ í•¨**.

### ğŸ”¹ `tags`
- **GitLab Runner íƒœê·¸**ë¥¼ ì§€ì •í•˜ì—¬ íŠ¹ì • Runnerì—ì„œ ì‹¤í–‰í•¨.

### ğŸ”¹ `script`
CI/CD ì‹¤í–‰ ì‹œ ì‹¤í–‰ë  ëª…ë ¹ì–´ ëª©ë¡:

1. **ì¶œë ¥ ë©”ì‹œì§€**
   ```sh
   echo "Deploying to TEST environment"
   ```
   - ë°°í¬ê°€ ì‹œì‘ë¨ì„ ì•Œë¦¬ëŠ” ë©”ì‹œì§€ë¥¼ ì¶œë ¥.

2. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   ```sh
   export ssh_user="test_user"
   export ssh_host="192.168.1.100"
   export ssh_opt="-o StrictHostKeyChecking=no"
   export base_path="/home/test_user/app/"
   export dir_name="deploy"
   ```
   - ì›ê²© ë°°í¬ë¥¼ ìœ„í•œ SSH ì ‘ì† ì •ë³´ ë° ê²½ë¡œ ê´€ë ¨ ë³€ìˆ˜ë¥¼ ì„¤ì •.

3. **SSH í‚¤ ê¶Œí•œ ì„¤ì •**
   ```sh
   chmod 400 ${TEST_PEM}
   ```
   - SSH í‚¤(`TEST_PEM`)ì˜ ê¶Œí•œì„ `400`(ì½ê¸° ì „ìš©)ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ë³´ì•ˆ ê°•í™”.

4. **SCPë¥¼ ì´ìš©í•œ íŒŒì¼ ì „ì†¡**
   ```sh
   scp ${ssh_opt} -r -O * ${ssh_user}@${ssh_host}:${base_path}/${dir_name}/
   ```
   - `scp` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  íŒŒì¼ì„ ì›ê²© ì„œë²„ë¡œ ë³µì‚¬.
   - ì£¼ìš” ì˜µì…˜:
     - `-r`: ë””ë ‰í† ë¦¬ ë³µì‚¬ ì˜µì…˜.
     - `-O`: ê¸°ë³¸ SCP í”„ë¡œí† ì½œ ì‚¬ìš©.
     - `${ssh_opt}`: SSH ì˜µì…˜ (`StrictHostKeyChecking=no`) ì ìš©.

---

## 3. ìš”ì•½
 **DEPLOY ë‹¨ê³„ì—ì„œ ì‹¤í–‰ë¨.**  
 **ìˆ˜ë™ ì‹¤í–‰ (`manual`) í•„ìš”.**  
 **íŠ¹ì • GitLab Runnerì—ì„œ ì‹¤í–‰ (`tags` ì‚¬ìš©).**  
 **SSHë¥¼ ì´ìš©í•´ ì›ê²© ì„œë²„ì— íŒŒì¼ ë°°í¬.**  

ì´ ì„¤ì •ì„ ìˆ˜ì •í•˜ì—¬ ìë™ ë°°í¬ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŒ.


